{% extends "base.html" %} {% block content %}

<table class="table table-hover table-bordered align-middle mb-0">
  <caption class="caption-top px-3 pt-3">
    <div
      class="d-flex flex-wrap justify-content-between align-items-center gap-2"
    >
      <div class="d-flex align-items-center gap-2">
        <i class="bi bi-tv fs-4"></i>
        <h2 class="h4 mb-0">Shows</h2>
        <span class="badge text-bg-secondary">{{ shows|length }}</span>
      </div>

      <!-- toolbar -->
      <div class="d-flex align-items-center gap-2">
        <div class="input-group input-group-sm" style="max-width: 280px">
          <span class="input-group-text bg-body"
            ><i class="bi bi-search"></i
          ></span>
          <input
            type="search"
            class="form-control"
            placeholder="Search title…"
            name="q"
          />
        </div>
        <div class="btn-group btn-group-sm" role="group" aria-label="Filters">
          <button class="btn btn-outline-secondary">
            <i class="bi bi-sort-alpha-down"></i>
          </button>
          <button class="btn btn-outline-secondary">
            <i class="bi bi-funnel"></i>
          </button>
          <a
            href="{{ request.url_for('list_shows') }}"
            class="btn btn-outline-secondary"
            aria-label="Reload shows"
          >
            <i class="bi bi-arrow-repeat"></i>
          </a>
        </div>

        <button
          type="button"
          class="btn btn-sm btn-primary ms-auto flex-shrink-0"
          data-bs-toggle="modal"
          data-bs-target="#addShowModal"
        >
          <i class="bi bi-tv me-1"></i> Add Show
        </button>
      </div>
    </div>
  </caption>

  <thead class="table-dark position-sticky top-0 z-1">
    <tr>
      <th>Title</th>
      <th class="text-center" style="width: 120px">Years</th>
      <th class="text-center" style="width: 160px">Network</th>
      <th class="text-center" style="width: 180px">Genre</th>
      <th>Leading Actor(s)</th>
      <th class="text-center" style="width: 140px">Rating</th>
      <th class="text-center" style="width: 80px">
        <i class="bi bi-database-check"></i>
      </th>
    </tr>
  </thead>

  <tbody>
    {% set ns = namespace(current_letter='') %} {% for show in
    shows|sort(attribute='title', case_sensitive=False) %} {# group header by
    first letter #} {% set raw = (show['sort_title'] or '')|trim %} {% set ch =
    raw[:1].upper() %} {% set group = ch if ch.isalpha() else '#' %} {% if group
    != ns.current_letter %}
    <tr class="table-primary" style="pointer-events: none">
      <td colspan="7" class="fw-bold bg-secondary text-center">{{ group }}</td>
    </tr>
    {% set ns.current_letter = group %} {% endif %}

    <tr
      role="button"
      class="clickable-row"
      data-href="/shows/{{ show['show_id'] }}"
    >
      <td>{{ show['title'] }}</td>

      {# Years: start-end, open-ended supported #}
      <td class="text-center">
        {% set sy = show['start_year'] %} {% set ey = show['end_year'] %} {% if
        sy and ey %} {{ sy }}–{{ ey }} {% elif sy %} {{ sy }}– {% elif ey %} –{{
        ey }} {% else %} {% endif %}
      </td>

      <td class="text-center">{{ show['network'] or '' }}</td>

      <td class="text-center">{{ show['genre'] or '' }}</td>

      <td>{{ show['leading_actors'] or '' }}</td>

      <td class="text-center">
        {% if show['rating'] is none %} {% for i in range(5) %}<i
          class="bi bi-star"
        ></i
        >{% endfor %} {% else %} {% set rating = show['rating']|float %} {% set
        full_stars = rating|int %} {% set half_star = 1 if rating - full_stars
        >= 0.5 else 0 %} {% set empty_stars = 5 - full_stars - half_star %} {%
        for i in range(full_stars) %}<i class="bi bi-star-fill"></i>{% endfor %}
        {% if half_star %}<i class="bi bi-star-half"></i>{% endif %} {% for i in
        range(empty_stars) %}<i class="bi bi-star"></i>{% endfor %} {% endif %}
      </td>

      <td class="text-center">
        {% if show['obtained'] == 'Yes' %}
        <i class="bi bi-check-circle text-success"></i>
        {% else %}
        <i class="bi bi-x-circle text-danger"></i>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- put this <script> after the table markup -->
<script src="static/scripts/shows.js"></script>

{% endblock %}
