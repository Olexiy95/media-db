{% extends "base.html" %} {% block content %}

<table class="table table-hover table-bordered align-middle mb-0">
  <caption class="caption-top px-3 pt-3">
    <div
      class="d-flex flex-wrap justify-content-between align-items-center gap-2"
    >
      <div class="d-flex align-items-center gap-2">
        <i class="bi bi-film fs-4"></i>
        <h2 class="h4 mb-0">Movies</h2>
        <!-- optional count -->
        <span class="badge text-bg-secondary"> {{ movies|length }} </span>
      </div>
      <!-- toolbar -->
      <div class="d-flex align-items-center gap-2">
        <div class="input-group input-group-sm" style="max-width: 280px">
          <span class="input-group-text bg-body"
            ><i class="bi bi-search"></i
          ></span>
          <input
            type="search"
            class="form-control"
            placeholder="Search titleâ€¦"
            name="q"
          />
        </div>
        <div class="btn-group btn-group-sm" role="group" aria-label="Filters">
          <button class="btn btn-outline-secondary">
            <i class="bi bi-sort-alpha-down"></i>
          </button>
          <button class="btn btn-outline-secondary">
            <i class="bi bi-funnel"></i>
          </button>
          <a
            href="{{ request.url_for('list_movies') }}"
            class="btn btn-outline-secondary"
            aria-label="Reload movies"
          >
            <i class="bi bi-arrow-repeat"></i>
          </a>
        </div>

        <button
          type="button"
          class="btn btn-sm btn-primary ms-auto flex-shrink-0"
          data-bs-toggle="modal"
          data-bs-target="#addMovieModal"
        >
          <i class="bi bi-film me-1"></i> Add Movie
        </button>
      </div>
    </div>
  </caption>
  <thead class="table-dark position-sticky top-0 z-1">
    <tr>
      <th>Title</th>
      <th class="text-center" style="width: 100px">Year</th>
      <th class="text-center" style="width: 160px">Genre</th>
      <th>Leading Actor(s)</th>
      <th class="text-center" style="width: 140px">Rating</th>
      <th class="text-center" style="width: 80px">
        <i class="bi bi-database-check"></i>
      </th>
    </tr>
  </thead>
  <tbody>
    {% set ns = namespace(current_letter='') %} {% for movie in movies %} {# ---
    figure out grouping letter --- #} {% set raw = (movie['sort_title'] or
    '')|trim %} {% set ch = raw[:1].upper() %} {% if ch.isalpha() %} {% set
    group = ch %} {% else %} {% set group = '#' %} {% endif %} {# --- render new
    header row when group changes --- #} {% if group != ns.current_letter %}
    <tr class="table-primary" style="pointer-events: none">
      <td colspan="7" class="fw-bold bg-secondary text-center">{{ group }}</td>
    </tr>
    {% set ns.current_letter = group %} {% endif %}

    <tr
      role="button"
      class="clickable-row"
      data-href="/movies/{{ movie['movie_id'] }}"
    >
      <td>{{ movie['title'] }}</td>
      <td class="text-center">{{ movie['year'] or "" }}</td>
      <td class="text-center">{{ movie['genre'] }}</td>
      <td>{{ movie['leading_actors'] }}</td>
      <td class="text-center">
        {% if movie['rating'] is none %} {% for i in range(5) %}<i
          class="bi bi-star"
        ></i
        >{% endfor %} {% else %} {% set rating = movie['rating']|float %} {% set
        full_stars = rating|int %} {% set half_star = 1 if rating - full_stars
        >= 0.5 else 0 %} {% set empty_stars = 5 - full_stars - half_star %} {%
        for i in range(full_stars) %}<i class="bi bi-star-fill"></i>{% endfor %}
        {% if half_star %}<i class="bi bi-star-half"></i>{% endif %} {% for i in
        range(empty_stars) %}<i class="bi bi-star"></i>{% endfor %} {% endif %}
      </td>
      <td class="text-center">
        {% if movie['obtained'] == 'Yes' %}
        <i class="bi bi-check-circle text-success"></i>
        {% else %}
        <i class="bi bi-x-circle text-danger"></i>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
<!-- put this <script> after the table markup -->
<script src="static/scripts/movies.js"></script>

{% endblock %}
